# 产品需求文档 (PRD)：3D 手势交互圣诞树照片墙生成器

## 1\. 项目概述

**项目名称：** Magic Christmas Tree（魔力圣诞树）
**核心功能：** 用户上传照片，系统将其映射到 3D 圣诞树的装饰球上。用户可以通过摄像头捕捉手势（如挥手、捏合）来控制 3D 树的旋转、缩放和特效。
**商业模式：** 免费试玩（带水印/低画质），付费（单次或会员）下载高清视频或获取去水印的独立分享链接。
**目标平台：** Web 端（移动端适配，但主要体验在 PC 端以获得更好的摄像头交互）。

## 2\. 用户流程 (User Flow)

1.  **着陆页 (Landing Page)：** 展示 3D 树的酷炫 Demo，介绍手势玩法，点击“开始制作”。
2.  **模版选择：** 浏览不同的圣诞树风格（如：赛博朋克风、温馨木屋风、极简冰雪风）。
3.  **内容上传：** 用户上传 10-50 张照片，提供简单的裁剪/排序工具。
4.  **预览与交互 (Core)：**
      * 生成 3D 场景。
      * 请求摄像头权限。
      * 用户通过手势控制树的展示（旋转、拉近、甚至让照片飞出重组）。
5.  **导出/付费：** 点击“保存/分享”。
      * **未付费：** 生成带水印的链接或低清截图。
      * **付费/会员：** 弹出支付窗口 -\> 支付成功 -\> 解锁高清录屏下载 (MP4) 或永久无水印 3D 网页链接。

## 3\. 功能需求详情 (Functional Requirements)

### 3.1 前端交互与 3D 场景

  * **3D 引擎：** 使用 WebGL 技术渲染圣诞树。
  * **照片映射：** 用户的照片需自动贴图到树上的装饰球（Ornaments）或悬浮卡片上。
  * **环境氛围：** 必须包含粒子特效（下雪）、动态光影（彩灯闪烁）和背景音乐。
  * **多模版支持：** 能够动态切换 3D 场景的材质（贴图）、光照配置和背景模型。

### 3.2 手势识别系统 (Gesture Control)

需要集成计算机视觉库，识别以下手势并绑定对应 3D 动作：

  * **单手握拳左右移动：** 旋转圣诞树（Orbit Controls）。
  * **双手张开/合拢：** 缩放场景（Zoom In/Out）。
  * **打响指/挥手：** 触发“爆炸视图”特效（照片球散开再重组）或切换灯光模式。
  * **兜底方案：** 如果用户没有摄像头，必须提供鼠标/触屏操作作为备选。

### 3.3 编辑器功能

  * **图片上传：** 批量上传，支持拖拽。
  * **智能裁剪：** 自动将图片裁剪为适合球体映射的比例（如 1:1 或圆形遮罩）。

### 3.4 支付与导出系统

  * **支付网关：** 集成 Stripe 或类似的支付接口。
  * **录屏导出：** 前端通过 Canvas 录制功能（MediaRecorder API）将当前的 3D 动画录制为 10-15 秒的短视频供用户下载。
  * **分享页生成：** 为付费用户生成一个唯一的 URL，朋友点开可以看到定制的 3D 树。

## 4\. 技术栈推荐 (Technical Stack)

*这是给 AI 编程最关键的指令，确保它选择当下最流行且好维护的库。*

  * **前端框架：** React + Vite + Tailwind CSS (开发效率高)。
  * **3D 渲染：** **React Three Fiber (R3F)** + Drei (这是基于 Three.js 的 React 封装，最适合做这种交互)。
  * **手势识别：** **MediaPipe Hands** (Google 出品，浏览器端性能最好，延迟低)。
  * **状态管理：** Zustand (轻量级，适合管理 3D 状态)。
  * **后端/数据库：** Supabase (提供 Auth、数据库和存储，适合快速开发) 或 Firebase。
  * **支付：** Stripe API。

## 5\. 数据结构 (Data Structure)

**User Template Object (示例):**
{
  "id": "uuid",
  "template_type": "cyberpunk_tree",
  "user_photos": [
    "url_to_storage_1.jpg",
    "url_to_storage_2.jpg"
  ],
  "bgm_track": "jingle_bells_remix.mp3",
  "is_paid": false
}

6. 开发阶段规划 (Development Phases)
为了让 AI 能够执行，建议分阶段让 AI 写代码：

Phase 1 - 基础 3D 场景： 搭建 React 环境，用 R3F 渲染一棵静态的圣诞树，加上 3D 轨道控制器（鼠标控制）。

Phase 2 - 照片映射： 实现图片上传功能，将上传的图片贴图到树上的球体模型上。

Phase 3 - 手势接入： 引入 MediaPipe，识别手部关键点，将手部坐标映射到 3D 场景的旋转和缩放参数上。

Phase 4 - UI 与模版： 美化界面，制作 2-3 个不同的背景/材质预设。

Phase 5 - 商业化： 接入支付按钮，实现“支付后去除水印/允许下载”的逻辑。